From ab5c3b7c0c7992dc8d606917c05e4cf81727b8bf Mon Sep 17 00:00:00 2001
From: Rong Bao <rong.bao@csmantle.top>
Date: Tue, 17 Feb 2026 19:09:40 +0800
Subject: [PATCH 2/2] AOSCOS: normalize sbin -> bin

---
 Makefile                                   | 4 ++--
 ex/99needrestart                           | 2 +-
 ex/apt/apt-pinvoke                         | 2 +-
 ex/icinga2/command.conf                    | 2 +-
 ex/icinga2/needrestart-sudoers             | 4 ++--
 ex/nagios/check_needrestart                | 2 +-
 ex/nagios/needrestart-nagios               | 2 +-
 ex/polkit/net.fiasko-nw.needrestart.policy | 2 +-
 needrestart                                | 2 +-
 9 files changed, 11 insertions(+), 11 deletions(-)

diff --git a/Makefile b/Makefile
index 1ab274a..1332759 100644
--- a/Makefile
+++ b/Makefile
@@ -31,8 +31,8 @@ install: all
 	mkdir -p "$(DESTDIR)/usr/share/polkit-1/actions"
 	cp ex/polkit/net.fiasko-nw.needrestart.policy "$(DESTDIR)/usr/share/polkit-1/actions/"
 	
-	mkdir -p "$(DESTDIR)/usr/sbin"
-	cp needrestart "$(DESTDIR)/usr/sbin/"
+	mkdir -p "$(DESTDIR)/usr/bin"
+	cp needrestart "$(DESTDIR)/usr/bin/"
 	
 	mkdir -p "$(DESTDIR)/usr/lib/needrestart"
 	cp lib/iucode-scan-versions "$(DESTDIR)/usr/lib/needrestart/"
diff --git a/ex/99needrestart b/ex/99needrestart
index dcdf48d..4dd5f8f 100644
--- a/ex/99needrestart
+++ b/ex/99needrestart
@@ -6,4 +6,4 @@
 # directory.
 #
 
-DPkg::Post-Invoke {"test -x /usr/sbin/needrestart && /usr/sbin/needrestart || true"; };
+DPkg::Post-Invoke {"test -x /usr/bin/needrestart && /usr/bin/needrestart || true"; };
diff --git a/ex/apt/apt-pinvoke b/ex/apt/apt-pinvoke
index d9d7a11..633841c 100755
--- a/ex/apt/apt-pinvoke
+++ b/ex/apt/apt-pinvoke
@@ -46,5 +46,5 @@ if [ -e "$RUNDIR/unpacked" ]; then
     fi
 
     rm -f "$RUNDIR/unpacked"
-    exec /usr/sbin/needrestart "$@"
+    exec /usr/bin/needrestart "$@"
 fi
diff --git a/ex/icinga2/command.conf b/ex/icinga2/command.conf
index d410b80..aefe321 100644
--- a/ex/icinga2/command.conf
+++ b/ex/icinga2/command.conf
@@ -1,5 +1,5 @@
 object CheckCommand "needrestart" {
-	command = [ "/usr/sbin/needrestart", "-p" ]
+	command = [ "/usr/bin/needrestart", "-p" ]
 	arguments = {
 		"-k" = {
 			description = "check for obsolete kernel"
diff --git a/ex/icinga2/needrestart-sudoers b/ex/icinga2/needrestart-sudoers
index ef55834..ac114f5 100644
--- a/ex/icinga2/needrestart-sudoers
+++ b/ex/icinga2/needrestart-sudoers
@@ -5,6 +5,6 @@
 #
 
 # Allow nagios to execute the needrestart command on debian based systems (icinga user is called "nagios")
-nagios ALL=NOPASSWD: /usr/sbin/needrestart
+nagios ALL=NOPASSWD: /usr/bin/needrestart
 # Allow nagios to execute the needrestart command on centos and family (icinga user is called "icinga")
-icinga ALL=NOPASSWD: /usr/sbin/needrestart
+icinga ALL=NOPASSWD: /usr/bin/needrestart
diff --git a/ex/nagios/check_needrestart b/ex/nagios/check_needrestart
index 1177fc7..d979422 100755
--- a/ex/nagios/check_needrestart
+++ b/ex/nagios/check_needrestart
@@ -15,4 +15,4 @@
 #   (at your option) any later version.
 #
 
-exec sudo -n -- /usr/sbin/needrestart -p
+exec sudo -n -- /usr/bin/needrestart -p
diff --git a/ex/nagios/needrestart-nagios b/ex/nagios/needrestart-nagios
index 74e8629..708c741 100644
--- a/ex/nagios/needrestart-nagios
+++ b/ex/nagios/needrestart-nagios
@@ -5,4 +5,4 @@
 #
 
 # Allow nagios to execute the needrestart command
-nagios		ALL=NOPASSWD: /usr/sbin/needrestart -p
+nagios		ALL=NOPASSWD: /usr/bin/needrestart -p
diff --git a/ex/polkit/net.fiasko-nw.needrestart.policy b/ex/polkit/net.fiasko-nw.needrestart.policy
index 65d20cd..d2287da 100644
--- a/ex/polkit/net.fiasko-nw.needrestart.policy
+++ b/ex/polkit/net.fiasko-nw.needrestart.policy
@@ -12,7 +12,7 @@
       <allow_inactive>auth_admin</allow_inactive>
       <allow_active>auth_admin</allow_active>
     </defaults>
-    <annotate key="org.freedesktop.policykit.exec.path">/usr/sbin/needrestart</annotate>
+    <annotate key="org.freedesktop.policykit.exec.path">/usr/bin/needrestart</annotate>
     <annotate key="org.freedesktop.policykit.exec.allow_gui">true</annotate>
   </action>
 
diff --git a/needrestart b/needrestart
index ad7e4aa..1be72e4 100755
--- a/needrestart
+++ b/needrestart
@@ -785,7 +785,7 @@ if(defined($opt_l)) {
 	    }
 	    else {
 		# sysv init
-		if($pid == 1 && $exe =~ m@^/sbin/init@) {
+		if($pid == 1 && $exe =~ m@^/bin/init@) {
 		    print STDERR "$LOGPREF #$pid is sysv init\n" if($nrconf{verbosity} > 1);
 		    $restart{q(sysv-init)}++;
 		    next;
-- 
2.53.0

